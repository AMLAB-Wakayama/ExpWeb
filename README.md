# 聴取実験用ウェブページ
### **遠隔で聴取実験を実施するためのウェブページです！** 

- 3種類の実験に対応

- 1つの実験を複数のブロック(タスク)に分割してもOK

- 参加者管理ができる

実験参加者ごとに実験結果フォルダが作成され、CSVで保存されます。実験参加者の意思で、実験途中に休憩を挟むことも可能です。

## 対応実験
- 音声の書き取り
  
  音声が1つずつ再生され、回答用紙に書き取ってフォームに入力　（例： 音声明瞭度／了解度試験）
- 一対比較
  
  音声が2つ連続で再生され、5つの選択肢から回答を選択　（例： ２つの音声の良否や特性の対比判断）
- 二肢強制選択
  
  音声が1つずつ再生され、2つの選択肢から回答を選択　（例： １つの音声のカテゴリ判断）

## 音声について
ここで例題として使用した音声は、ESPNetを用いて合成しました。
[GoogleColab espnet2_tts_demo](https://colab.research.google.com/github/espnet/notebook/blob/master/espnet2_tts_realtime_demo.ipynb)に、テキストを入力して音声合成し、48kHzにリサンプリングしました。（開発者に感謝いたします。）

実験で提示する音声／音響信号は、かならず48kHz, 16bitのwav fileにしてください。それ以外だと再生されないこともあるかもしれません。

## デモ

- 音声の書き取り: https://web.wakayama-u.ac.jp/~irino/ExpWeb/ExpSpIntel_Example/index.php
- 一対比較: https://web.wakayama-u.ac.jp/~irino/ExpWeb/ExpPairCmpr_Example/index.php

## 必要なプログラム
3つの実験のうち、どの実験を行うかで必要なファイルが異なります。3つの実験全てで使用する共通のファイルと実験特有のファイルがあります。

実験特有のファイルは、ファイルの末尾に実験名(英語)がついています。
- 音声の書き取り: `*****_SpIntel`
- 一対比較: `*****_PairCmpr`
- 二肢強制選択: `*****_TwoAlt`

必要なファイルの一覧は[README_FileList.md](README_FileList.md)をご覧ください。

## 使い方
全てのファイルをそのままサーバーにおいていただくと、音声の書き取り実験(SpIntel)が実施できる状態になっています。

1. 必要なプログラムを全てサーバーへ
2. index.phpにアクセス

`param.php`で実験方法や内容を制御しています。他の実験方法を行う場合は、`param_***.php`のファイル名を末尾の実験名を除いた`param.php`に変更してください。

例：一対比較実験(PairCmpr)を行う場合、`param_PairCmpr.php`のファイル名を`param.php`に変更

## 実験のカスタマイズ
- **実験全体を制御する`param.php`を設定**

  `param.php`を編集し、実験内容を設定することでオリジナルの聴取実験が実施できます。

  `param.php`で設定できる内容
  - 実験名
  - 問題数とセッション数 etc...

  `param.php`を編集する際の細かい注意点は、プログラム内のコメントをご覧ください。
  長時間に及ぶ実験の場合、参加者の集中を切らさないためにも、できるだけ小さいセッションやブロックを複数回行うような実験内容の設計をおすすめします。 

- **音声リスト**

  CSVファイルに対応しています。また、音声リストには必ずセッション番号をふってください。セッション番号を自動で判断し、練習セッションを実施した後、本番セッションが開始されます。

  - 練習 → セッション番号: 99
  - 本番 → セッション番号: 1-98

## 参加者管理
特定の人の参加を承諾しないことができます（例：以前の実験参加者には、今回の実験の参加しないようにしてもらう）。また、実験を複数のブロック(タスク)に分割した場合、前回の参加者のみを受け付けることができます。

- **参加を承諾しない**

  参加を承諾しないIDリスト`id_reject.csv`をフォルダ`Result`に置いてください。このファイルが存在すれば、自動で判断します。

- **前回のブロック(タスク)参加者のみ受付**

  2ブロック(タスク)以降は、必ず前回の参加者か判断する仕様になっています。前回のブロック(タスク)で生成された`id_sndlevel.csv`をフォルダ`Result`に置いてください。

## 環境
正常に動作を確認したのは以下の環境です。
- Google Chromeにのみ対応
  
  (これは、WindowsとMacで共通に使用でき、正しい音量が出力されるものとして限定しました。）

- Apache 2.4.46
- PHP 7.3.24


## 注意事項
- **文字コード**

  CSVファイルの文字コードはUTF-8です。ただし「BOM付きUTF-8」の場合、実験参加者の管理などが機能しない場合があります。リスト作成等でExcelを使ったところ動作が変になった場合がありました。かならず動作確認をお願いします。

- **アクセス権**

  ファイルやフォルダのアクセス権限に注意してください。「回答データが保存されない」「音声が再生されない」原因になります。
  - Result: 読み書き許可
  - id.csv: 読み書き許可
  - id_sndlevel.csv: 読み書き許可
  - その他のフォルダ: 読み取り許可

## 作成者
和歌山大学 システム工学部 聴覚メディア研究室

## ライセンス
Apache-2.0 License